srcdir=@srcdir@
abs_srcdir=@abs_srcdir@
export prefix=@prefix@
export exec_prefix=@exec_prefix@
export bindir=@bindir@
export datadir=@datarootdir@/b2l
export datalibdir=@datarootdir@/b2l/lib
export databindir=@datarootdir@/b2l/bin
VPATH=$(srcdir)
LUA_MAJ=5
LUA_MIN=2
LUA_REV=3
LUA_SRC_DIR=$(srcdir)/lua-$(LUA_MAJ).$(LUA_MIN).$(LUA_REV)
ABS_LUA_SRC_DIR=$(abs_srcdir)/lua-$(LUA_MAJ).$(LUA_MIN).$(LUA_REV)
LGI_SRC_DIR=$(srcdir)/lgi

INSTALL?=install
INSTALL_PROGRAM?=$(INSTALL)
INSTALL_DATA?=$(INSTALL) -m 644

LGI_OPTS := "LUA_LIBDIR=${datalibdir}/lua"
LGI_OPTS += " LUA_SHAREDIR=${datadir}/lua"
LGI_OPTS += " LUA_VERSION=5.2"
LGI_OPTS += " CFLAGS=-I$(ABS_LUA_SRC_DIR)/src"

all: lua lgi material-editor

.PHONY: lua
lua:
	$(MAKE) -C $(LUA_SRC_DIR) linux

.PHONY: lgi
lgi:
	$(MAKE) -C $(LGI_SRC_DIR) $(LGI_OPTS)

.PHONY: material-editor
material-editor:
	$(MAKE) -C material-editor

clean:
	$(MAKE) -C $(LUA_SRC_DIR) clean
	$(MAKE) -C $(LGI_SRC_DIR) $(LGI_OPTS) clean
	$(MAKE) -C material-editor clean

install: lua lgi material-editor
	$(INSTALL) -d ${datalibdir}
	$(INSTALL) -d ${databindir}
	$(INSTALL) -d ${datadir}
	$(INSTALL) $(LUA_SRC_DIR)/src/lua ${databindir}
	$(INSTALL_PROGRAM) b2l-setenv.sh ${bindir}
	$(MAKE) -C $(LGI_SRC_DIR) $(LGI_OPTS) install
	$(MAKE) -C material-editor install
